- name: Install Evergreen Web Prereqs
  become: true
  shell: >
    cd {{repo_base}}/Evergreen
    && PERL_MM_USE_DEFAULT=1 make -f 
    Open-ILS/src/extras/Makefile.install {{os_build_target}}-developer
- name: Set ownership of {{repo_base}} to {{deploy_user}}
  become: true
  file: dest="{{repo_base}}" owner={{deploy_user}} group={{deploy_user}} recurse=yes
- name: AngularJS Node Build
  become: true
  become_user: opensrf
  npm: path={{repo_base}}/Evergreen/Open-ILS/web/js/ui/default/staff
- name: AngularJS npm build
  shell: >
    cd {{repo_base}}/Evergreen/Open-ILS/web/js/ui/default/staff 
    && npm run build-prod
  become: true
  become_user: opensrf
#- name: AngularJS npm test
#  become: true
#  become_user: opensrf
#  environment:
#    CHROME_BIN: /usr/bin/chromium-browser
#  shell: >
#    cd {{repo_base}}/Evergreen/Open-ILS/web/js/ui/default/staff 
#    && npm run test
- name: Angular Node Build
  npm: path={{repo_base}}/Evergreen/Open-ILS/src/eg2
  become: true
  become_user: opensrf
- name: Angular build
  shell: >
    cd {{repo_base}}/Evergreen/Open-ILS/src/eg2
    && ng build --configuration=production
  become: true
  become_user: opensrf
#- name: Angular test
#  become: true
#  become_user: opensrf
#  environment:
#    CHROME_BIN: /usr/bin/chromium-browser
#  shell: >
#    cd {{repo_base}}/Evergreen/Open-ILS/src/eg2
#    && npm run test
- name: BooPAC Node Build
  npm: path={{repo_base}}/Evergreen/Open-ILS/web/opac/deps
  become: true
  become_user: opensrf
